<!DOCTYPE html>
<html>
    <head>
        <title>Admitted Demographics</title>
        <script src="https://d3js.org/d3.v4.js"></script>
    </head>
    <body>
    <div id="select-div2" class="sel4"></div>
        <div id="two_divs" style="display: table;">
            <div id="my_dataviz3" style="display: table-cell;"></div>
            <div id="my_dataviz4" style="display: table-cell;"></div>
        </div>
    <script>
        let data1 = {"Asian": 29780, "White": 17443, "International": 17150, "Chicano_Latino": 15743, "African_American": 4455, "Decline_to_State": 3006, "Native_American_Alaska_Native": 292, "Pacific_Islander": 198};

        function total(dict_to_sum) {
            let values = Object.keys(dict_to_sum).map(function(key){
                return dict_to_sum[key];
            })
            let sum = values.reduce((a,b) => a + b, 0)
            return sum
        }

        let color = d3.scaleOrdinal(['#5A3B48','#FFCAB1','#095c4d','#000080','#93B7BE','#AD6A6C','#C8E4D3','#575A4B']);

        // set the dimensions and margins of the graph
        var width = 400
            height = 400
            margin1 = 20

        // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
        var radius2 = Math.min(width, height) / 2 - margin1

        // append the svg7 object to the div called 'my_dataviz1'
        var svg7 = d3.select("#my_dataviz3")
            .append("svg")
                .attr("width", width)
                .attr("height", height)
            .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        // Compute the position of each group on the pie:
        var pie = d3.pie()
            .value(function(d) {return d.value; })
        var pied_data = pie(d3.entries(data1))

        var tooltip3 = d3.select("#my_dataviz3").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        var tooltip4 = d3.select("#my_dataviz4").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
        svg7
            .selectAll('all')
            .data(pied_data)
            .enter()
            .append('path')
            .attr('d', d3.arc()
                .innerRadius(radius2 * 0.5)
                .outerRadius(radius2)
           )
            .attr('fill', function(d){ return(color(d.data.key)) })
            .attr("stroke", "black")
            .style("stroke-width", "1px")
            .on("mouseover", function(d, i) {
                d3.select(this)
                    .style("opacity", 0.7)
                tooltip3.transition()
                    .duration(200)
                    .style("opacity", 1)
                tooltip3.html("<strong>"+ keyDict[keys[i]] + "</strong><br>" + Math.round(data1[keys[i]] / total(data1) * 10000) / 100 + "%")
                    .style("left", d3.event.pageX + "px")
                    .style("top", d3.event.pageY + "px")
                    .style("text-align", "center")
                    .style("width", "150px")
                    .style("height", "80px")
                    .style("border", "0px")
              })
            .on("mouseout", function(d) {
                d3.select(this)
                    .style("opacity", 1)
                tooltip3.transition()
                    .style("opacity", 0)
                })
        </script>
    </script>
    <script>
let pie_data = {
    "2019-20": {
        "Asian": 28942,
        "White": 18026,
        "International": 16984,
        "Chicano_Latino": 15891,
        "African_American": 4362,
        "Decline_to_State": 2652,
        "Native_American_Alaska_Native": 339,
        "Pacific_Islander": 203
    },
    "2018-19": {
        "Asian": 28977,
        "White": 18916,
        "International": 17015,
        "Chicano_Latino": 16306,
        "African_American": 4747,
        "Decline_to_State": 3054,
        "Native_American_Alaska_Native": 382,
        "Pacific_Islander": 224
    },
    "2017-18": {
        "Asian": 25982,
        "White": 20059,
        "International": 15371,
        "Chicano_Latino": 15907,
        "African_American": 4442,
        "Decline_to_State": 2646,
        "Native_American_Alaska_Native": 428,
        "Pacific_Islander": 222
    },
    "2016-17": {
        "Asian": 24766,
        "White": 19913,
        "International": 15571,
        "Chicano_Latino": 14755,
        "African_American": 4225,
        "Decline_to_State": 2729,
        "Native_American_Alaska_Native": 422,
        "Pacific_Islander": 200
    },
    "2015-16": {
        "Asian": 24484,
        "White": 18855,
        "International": 14561,
        "Chicano_Latino": 13949,
        "African_American": 3961,
        "Decline_to_State": 2510,
        "Native_American_Alaska_Native": 417,
        "Pacific_Islander": 187
    },
    "2014-15": {
        "Asian": 23199,
        "White": 17855,
        "International": 13258,
        "Chicano_Latino": 13189,
        "African_American": 3558,
        "Decline_to_State": 2083,
        "Native_American_Alaska_Native": 444,
        "Pacific_Islander": 193
    },
    "2013-14": {
        "Asian": 21228,
        "White": 16936,
        "International": 11295,
        "Chicano_Latino": 12371,
        "African_American": 3403,
        "Decline_to_State": 1961,
        "Native_American_Alaska_Native": 328,
        "Pacific_Islander": 195
    },
    "2012-13": {
        "Asian": 20568,
        "White": 15452,
        "International": 9169,
        "Chicano_Latino": 11131,
        "African_American": 3143,
        "Decline_to_State": 1708,
        "Native_American_Alaska_Native": 368,
        "Pacific_Islander": 192
    },
    "2011-12": {
        "Asian": 18417,
        "White": 14640,
        "International": 6080,
        "Chicano_Latino": 9445,
        "African_American": 2657,
        "Decline_to_State": 1284,
        "Native_American_Alaska_Native": 331,
        "Pacific_Islander": 137
    },
    "2010-11": {
        "Asian": 17331,
        "White": 14206,
        "International": 4754,
        "Chicano_Latino": 8216,
        "African_American": 2673,
        "Decline_to_State": 2733,
        "Native_American_Alaska_Native": 352,
        "Pacific_Islander": 128
    },
    "2009-10": {
        "Asian": 16689,
        "White": 14679,
        "International": 4226,
        "Chicano_Latino": 7783,
        "African_American": 2327,
        "Decline_to_State": 2572,
        "Native_American_Alaska_Native": 272,
        "Pacific_Islander": 125
    },
    "2008-09": {
        "Asian": 16590,
        "White": 15060,
        "International": 3212,
        "Chicano_Latino": 7657,
        "African_American": 2249,
        "Decline_to_State": 3265,
        "Native_American_Alaska_Native": 248,
        "Pacific_Islander": 181
    },
    "2007-08": {
        "Asian": 15898,
        "White": 14053,
        "International": 2559,
        "Chicano_Latino": 6404,
        "African_American": 2029,
        "Decline_to_State": 2813,
        "Native_American_Alaska_Native": 234,
        "Pacific_Islander": 161
    },
    "2006-07": {
        "Asian": 15603,
        "White": 13053,
        "International": 2058,
        "Chicano_Latino": 5916,
        "African_American": 1853,
        "Decline_to_State": 2865,
        "Native_American_Alaska_Native": 251,
        "Pacific_Islander": 151
    },
    "2005-06": {
        "Asian": 13523,
        "White": 12065,
        "International": 1843,
        "Chicano_Latino": 4930,
        "African_American": 1573,
        "Decline_to_State": 2711,
        "Native_American_Alaska_Native": 190,
        "Pacific_Islander": 144
    },
    "2004-05": {
        "Asian": 13533,
        "White": 11562,
        "International": 1774,
        "Chicano_Latino": 4818,
        "African_American": 1553,
        "Decline_to_State": 3240,
        "Native_American_Alaska_Native": 185,
        "Pacific_Islander": 119
    },
    "2003-04": {
        "Asian": 13137,
        "White": 11581,
        "International": 1901,
        "Chicano_Latino": 4617,
        "African_American": 1721,
        "Decline_to_State": 3665,
        "Native_American_Alaska_Native": 199,
        "Pacific_Islander": 155
    },
    "2001-02": {
        "Asian": 13220,
        "White": 11403,
        "International": 2207,
        "Chicano_Latino": 3980,
        "African_American": 1446,
        "Decline_to_State": 3533,
        "Native_American_Alaska_Native": 207,
        "Pacific_Islander": 104
    },
    "2002-03": {
        "Asian": 13401,
        "White": 11772,
        "International": 1931,
        "Chicano_Latino": 4247,
        "African_American": 1558,
        "Decline_to_State": 3240,
        "Native_American_Alaska_Native": 200,
        "Pacific_Islander": 123
    },
    "2000-01": {
        "Asian": 12140,
        "White": 10885,
        "International": 1878,
        "Chicano_Latino": 3438,
        "African_American": 1311,
        "Decline_to_State": 3312,
        "Native_American_Alaska_Native": 172,
        "Pacific_Islander": 109
    },
    "1999-2000": {
        "Asian": 11444,
        "White": 10740,
        "International": 1681,
        "Chicano_Latino": 2817,
        "African_American": 1135,
        "Decline_to_State": 3038,
        "Native_American_Alaska_Native": 157,
        "Pacific_Islander": 95
    },
    "1998-99": {
        "Asian": 10233,
        "White": 8892,
        "International": 1695,
        "Chicano_Latino": 3140,
        "African_American": 1250,
        "Decline_to_State": 4568,
        "Native_American_Alaska_Native": 175,
        "Pacific_Islander": 89
    },
    "1997-98": {
        "Asian": 10219,
        "White": 9104,
        "International": 1550,
        "Chicano_Latino": 2855,
        "African_American": 1159,
        "Decline_to_State": 2025,
        "Native_American_Alaska_Native": 139,
        "Pacific_Islander": 100
    },
    "1996-97": {
        "Asian": 9225,
        "White": 8427,
        "International": 1252,
        "Chicano_Latino": 2824,
        "African_American": 1221,
        "Decline_to_State": 1887,
        "Native_American_Alaska_Native": 169,
        "Pacific_Islander": 99
    }
}
    </script> 
    <script>
let keys = Object.keys(pie_data["1996-97"])
let keyDict = {"Asian": "Asian", "White": "White", "International": "International", "Chicano_Latino": "Chicanx Latinx", "African_American": "African American", "Decline_to_State": "Unknown", "Native_American_Alaska_Native": "Native American Alaska Native", "Pacific_Islander": "Pacific Islander"}

let selectedCategory2 = "2019-20"

const select2 = d3.select('#select-div2')
.append('select')
.attr('id', 'category-select')

select2
  .selectAll('option')
  .data(Object.keys(pie_data))
  .enter()
  .append('option')
  .attr('value', function (d) {
    return d
  })
  .text(function (d) {
    return d
  })

const svg6 = d3
  .select('#my_dataviz4')
.append("svg")
    .attr("width", width)
    .attr("height", height)
.append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");


update2()

function update2(d, i) {
  let data2 = pie_data[selectedCategory2]
  let pied_data2 = pie(d3.entries(data2))
  svg6
      .selectAll('all')
      .data(pied_data2)
      .enter()
      .append('path')
      .attr('d', d3.arc()
          .innerRadius(radius2 * 0.5)
          .outerRadius(radius2)
      )
      .attr('fill', function(d){ return(color(d.data.key)) })
      .attr("stroke", "black")
      .style("stroke-width", "1px")
      .on("mouseover", function(d, i) {
          d3.select(this)
              .style("opacity", 0.7)
          tooltip4.transition()
              .style("opacity", 1)
          tooltip4.html("<strong>"+ keyDict[keys[i]] + "</strong><br>" + Math.round(data2[keys[i]] / total(data2) * 10000) / 100 + "%")
              .style("left", d3.event.pageX + "px")
              .style("top", d3.event.pageY + "px")
                    .style("text-align", "center")
                    .style("width", "150px")
                    .style("height", "80px")
                    .style("border", "0px")
        })
      .on("mouseout", function(d) {
          d3.select(this)
              .style("opacity", 1)
          tooltip4.transition()
              .style("opacity", 0)
          })
};

select2.on("change", function (d) {
      selectedCategory2 = d3.select(this).property("value");
      svg6.selectAll("*").remove();
      update2();
  })
    </script>
    </body>
</html>
